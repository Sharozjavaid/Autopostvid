# Philosophy Video Generator - 

## Project Overview
This is a full-stack application for generating AI-powered philosophy-themed slideshows and videos.
- **Backend**: FastAPI + SQLAlchemy + SQLite (Python 3.11+)
- **Frontend**: React + TypeScript + Vite + TanStack Query
- **AI Services**: OpenAI GPT-4, Gemini, ElevenLabs, fal.ai

## Directory Structure
```
/backend/app/          # FastAPI application
  /models/             # SQLAlchemy models (Project, Slide, SlideVersion, Automation, GalleryItem)
  /routers/            # API endpoints (projects, slides, images, scripts, automations, gallery, agent)
  /services/           # Business logic (image generation, text overlay, voice, agent_service)
  /schemas/            # Pydantic schemas
  /websocket/          # WebSocket for progress updates
/frontend/src/         # React application
  /api/client.ts       # API client with all endpoints (including gallery)
  /components/         # Reusable components (SlideEditor, GlassCard, AgentSlidePreview, GalleryPanel)
  /context/            # React contexts (AuthContext, GalleryContext)
  /pages/              # Page components (Agent, StaticSlideshow, Projects, etc.)
/fonts/                # Custom fonts for text overlay
/logs/                 # Runtime logs (gitignored)
```

## Running the Project
```bash
./dev.sh      # Development mode (recommended) - runs frontend + backend with colored logs
./start.sh    # Background mode - services run after terminal closes
./stop.sh     # Stop all services
./logs.sh     # View logs (--backend, --frontend, --errors options)
```

## Key Conventions

### Backend (Python/FastAPI)
- All models use UUID strings as primary keys
- Use SQLAlchemy ORM with relationship definitions
- Routers follow REST conventions: GET/POST/PUT/DELETE
- Always create SlideVersion when modifying slide images or content
- Image generation always creates: background â†’ text overlay â†’ final image
- Use `slide.create_version(db, change_type, description)` for versioning

### Frontend (React/TypeScript)
- Use TanStack Query for all API calls with proper queryKey patterns
- Use `getSlideImageUrl(path, cacheBuster?)` for all image URLs (production-ready)
- Never hardcode `http://127.0.0.1:8001` - use `API_BASE_URL` from client.ts
- Components use inline styles with motion from framer-motion
- GlassCard is the standard card component with `padding` and `gradient` props

### API Client Pattern
```typescript
// Always import helpers from client.ts
import { getSlideImageUrl, API_BASE_URL, reapplyTextOverlay } from '../api/client';

// Image URLs must use the helper for production compatibility
<img src={getSlideImageUrl(slide.final_image_path, cacheBuster) || ''} />
```

### Slide Versioning System
- Every image change creates a version in `slide_versions` table
- Change types: 'initial', 'text_edit', 'font_change', 'theme_change', 'regenerate', 'revert'
- Font changes use `/api/images/{id}/reapply-text` (fast, reuses background)
- Theme changes require full regeneration (new background needed)
- Versions can be retrieved with `/api/images/{id}/versions`
- Revert with `/api/images/{id}/revert/{version_number}`

### Image Generation Flow
1. Generate background image (AI) â†’ saved to `background_image_path`
2. Apply text overlay (Pillow) â†’ saved to `final_image_path`
3. Create SlideVersion with font/theme used
4. Update slide.current_font, current_theme, current_version

### Theme System
Available themes: `glitch_titans`, `oil_contrast`, `golden_dust`, `scene_portrait`
Each theme defines: base_prompt, hook_prompt, content_prompt, outro_prompt, negative_prompt

### Font System - Complete Architecture

#### How Fonts Work in the Slideshow Pipeline

The slideshow generation uses a **two-layer compositing system**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 1: Background Image (AI-Generated)                   â”‚
â”‚  - Generated by GPT-Image-1.5, Flux, or DALL-E 3            â”‚
â”‚  - Contains NO text - pure visual/artistic background       â”‚
â”‚  - Saved to: slide.background_image_path                    â”‚
â”‚  - Dimensions: 1080x1920 (TikTok 9:16 vertical)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 2: Text Overlay (Pillow/PIL)                         â”‚
â”‚  - Rendered programmatically using TextOverlay class        â”‚
â”‚  - Uses TTF font files from /fonts/ directory               â”‚
â”‚  - Applies: shadow, outline, positioning, word wrap         â”‚
â”‚  - Composited onto background â†’ saved to final_image_path   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Why this separation matters:**
- Font changes are FAST (reuses existing background, just re-renders text)
- Theme changes require full regeneration (new AI background needed)
- Text is always crisp (not AI-generated, so no artifacts)
- Consistent typography across all slides

#### Available Fonts

| Font ID | Name | Style | Best For |
|---------|------|-------|----------|
| `tiktok` | TikTok Sans | Official TikTok font, clean modern | Authentic TikTok look |
| `tiktok-bold` | TikTok Sans Bold | Official TikTok display | Bold headlines |
| `social` | Social Media (Default) | Montserrat Bold, sentence case | General social media |
| `bebas` | Bebas Neue | ALL CAPS display | Impact/punch |
| `montserrat` | Montserrat Bold | Modern sans-serif | Clean modern look |
| `cinzel` | Cinzel Bold | Roman/classical | Ancient wisdom vibes |
| `oswald` | Oswald Bold | Condensed sans | Strong headlines |
| `cormorant` | Cormorant Italic | Elegant serif italic | @philosophaire style |

#### Font Files Location

```
/fonts/                          # Project root fonts directory
  â”œâ”€â”€ TikTokSans-Regular.ttf     # Official TikTok font
  â”œâ”€â”€ TikTokSans-Bold.ttf        # Official TikTok bold
  â”œâ”€â”€ Montserrat-Bold.ttf        # Default for "social" style
  â”œâ”€â”€ Montserrat-Italic.ttf
  â”œâ”€â”€ Bebas-Regular.ttf          # All-caps display
  â”œâ”€â”€ Cinzel-Bold.ttf            # Classical/Roman
  â”œâ”€â”€ Oswald-Bold.ttf            # Condensed headlines
  â””â”€â”€ CormorantGaramond-Italic.ttf  # Elegant italic
```

#### Font Configuration in Code

Each font has settings that control rendering behavior:

```python
# In text_overlay.py - FONTS dict
"tiktok": {
    "name": "TikTok Sans",
    "file": "TikTokSans-Regular.ttf",
    "category": "tiktok",
    "settings": {
        "uppercase": False,      # Sentence case (True = ALL CAPS)
        "shadow": True,          # Drop shadow for legibility
        "outline": True,         # Thin outline for contrast
        "outline_width": 2,      # Outline thickness in pixels
    }
}
```

#### API Endpoints for Fonts

```bash
# Get available fonts (frontend uses this for dropdowns)
GET /api/settings/models
# Returns: { fonts: [{ id, name, style }], ... }

# Generate image with specific font
POST /api/images/{slide_id}/generate
Body: { model: "gpt15", font: "tiktok", theme: "golden_dust" }

# Change font only (fast - reuses background)
POST /api/images/{slide_id}/reapply-text?font=tiktok-bold

# Full regenerate with new theme + font
POST /api/images/{slide_id}/generate
Body: { model: "gpt15", font: "bebas", theme: "oil_contrast" }
```

#### Adding a New Font

1. **Add TTF file** to `/fonts/` directory
2. **Update both text_overlay.py files:**
   - `/text_overlay.py` (root - for CLI/scripts)
   - `/backend/app/services/text_overlay.py` (for API)
3. **Add to FONTS dict:**
```python
"new-font": {
    "name": "Display Name",
    "description": "What it looks like",
    "file": "NewFont-Bold.ttf",
    "category": "modern",  # tiktok, social, modern, elegant, classical, display
    "settings": { ... }  # Optional overrides
}
```
4. **Add to FONT_CATEGORIES** if creating new category
5. **Update API response** in `/backend/app/main.py`:
```python
"fonts": [
    {"id": "new-font", "name": "Display Name", "style": "Description"},
    ...
]
```

#### Font Rendering Details (TextOverlay class)

The TextOverlay class handles all text rendering with these methods:

```python
# Simple text on image
overlay.add_text_to_image(image_path, text, output_path, font_name="tiktok")

# Full slide with title, subtitle, number
overlay.create_slide(
    background_path="bg.png",
    output_path="slide.png",
    title="MARCUS AURELIUS",
    subtitle="The Emperor-Philosopher",
    slide_number=1,
    font_name="tiktok-bold"
)

# Hook slide (first slide - grabs attention)
overlay.create_hook_slide(background_path, output_path, hook_text, font_name="tiktok")

# Outro slide (call to action)
overlay.create_outro_slide(background_path, output_path, text, subtitle, font_name="social")
```

#### Text Rendering Effects

1. **Shadow**: Drop shadow for depth (offset 3-4px, semi-transparent black)
2. **Outline**: Thin stroke around text for legibility on any background
3. **Social Style**: Combines shadow + thin outline (best for readability)

```python
# Social style rendering (used by tiktok, social fonts)
def _draw_text_social_style(draw, position, text, font):
    # 1. Draw drop shadow (offset bottom-right)
    # 2. Draw thin outline (2px black stroke)
    # 3. Draw white text on top
```

#### Important Notes

- **Backend runs from /backend/**: Font path is resolved as `Path(__file__).parent.parent.parent.parent / "fonts"`
- **Font caching**: TextOverlay caches loaded fonts by size for performance
- **Fallback fonts**: If custom font fails, falls back to system fonts (Helvetica, Arial)
- **TikTok dimensions**: All slides are 1080x1920 (9:16 vertical format)

## Common Tasks

### Adding a New API Endpoint
1. Add route in `/backend/app/routers/<router>.py`
2. Add Pydantic schema in `/backend/app/schemas/` if needed
3. Add client function in `/frontend/src/api/client.ts`
4. Use in component with useMutation or useQuery

### Adding a New Slide Field
1. Add column to `/backend/app/models/slide.py`
2. Add to SlideVersion model if it should be versioned
3. Update Slide interface in `/frontend/src/api/client.ts`
4. Backend will auto-migrate on restart (SQLite)

### Debugging Image Issues
1. Check `logs/backend.log` for generation errors
2. Verify `background_image_path` exists on filesystem
3. Check browser console for image URL issues
4. Use `./logs.sh --errors` to find all errors

## Environment Variables

### Backend (.env in root)
```
OPENAI_API_KEY=sk-...
GOOGLE_API_KEY=...
ELEVENLABS_API_KEY=...
FAL_KEY=...
ANTHROPIC_API_KEY=...
```

## Claude API Configuration

### Model Selection
The agent uses Claude for tool-calling. Model is configured in `agent_runner.py`:

```python
# Current model (change this to switch)
CLAUDE_MODEL = "claude-sonnet-4-5-20250929"

# Available models for prompt caching:
# - claude-sonnet-4-5-20250929 (recommended - best price/performance)
# - claude-opus-4-20250514 (most capable)
# - claude-haiku-3-5-20241022 (fastest/cheapest)
```

**Important**: Also update `agent_tools.py` if you change the model (used for vision analysis).

### Prompt Caching
We use Anthropic's prompt caching for 90% cost reduction on repeated content:

- **Tools**: Cached via `cache_control` on last tool definition
- **System prompt**: Cached as separate block
- **Memory context**: Cached separately (allows updates without invalidating system cache)

Cache pricing (Claude Sonnet 4.5):
- Base input: $3/MTok
- Cache write: $3.75/MTok (1.25x, one-time)
- Cache read: $0.30/MTok (0.1x, 90% savings!)

Monitor cache usage in logs:
```
ğŸ“Š Cache: read=4500, created=0, uncached=50
```

### Key Files
- `agent_runner.py` - Main agent with CLAUDE_MODEL constant
- `agent_tools.py` - Tool definitions + vision analysis (also uses CLAUDE_MODEL)

### Frontend (.env in /frontend)
```
VITE_API_URL=http://127.0.0.1:8001  # or production URL
```

## Database
- SQLite database at `/backend/philosophy_generator.db`
- Models auto-create tables on startup
- Use Alembic for production migrations if needed

## Testing Changes
1. Backend auto-reloads with `--reload` flag
2. Frontend uses Vite HMR for instant updates
3. Always test font changes (fast path) and theme changes (full regen) separately
4. Check version history UI after making changes

## Production Deployment

### Domain & Infrastructure Overview
| Service | URL | Status |
|---------|-----|--------|
| **React Frontend** | `https://app.cofndrly.com` | âœ… Live on Vercel |
| **Backend API** | `https://api.cofndrly.com` | âœ… Live on GCP VM |
| **Static Images** | `https://api.cofndrly.com/static/images/...` | âœ… Served by FastAPI |
| **Static Slides** | `https://api.cofndrly.com/static/slides/...` | âœ… Served by FastAPI |
| **TikTok Callback** | `https://api.cofndrly.com/api/tiktok/callback` | âœ… Verified |

### GCP VM Details
- **VM Name**: `philosophy-bot-vm`
- **Zone**: `us-central1-a`
- **External IP**: `23.251.149.244`
- **Domain**: `api.cofndrly.com` â†’ points to the VM (A record in GoDaddy)
- **Code Location on VM**: `/home/runner/philosophy_video_generator`

### Accessing the VM
```bash
# List VMs
gcloud compute instances list

# SSH into the VM
gcloud compute ssh philosophy-bot-vm --zone=us-central1-a

# Run a command on the VM
gcloud compute ssh philosophy-bot-vm --zone=us-central1-a --command="your-command-here"

# Check if backend is running
gcloud compute ssh philosophy-bot-vm --zone=us-central1-a --command="ps aux | grep uvicorn"

# View backend logs
gcloud compute ssh philosophy-bot-vm --zone=us-central1-a --command="cat /home/runner/philosophy_video_generator/logs/backend.log"
```

### SSL/HTTPS Setup (Already Configured)
- **Nginx** is installed as a reverse proxy on the VM
- **Let's Encrypt** SSL certificate via certbot (auto-renews)
- Config file: `/etc/nginx/sites-available/api.cofndrly.com`

Nginx proxies:
- `https://api.cofndrly.com` â†’ `http://127.0.0.1:8001` (backend)

To check nginx status:
```bash
gcloud compute ssh philosophy-bot-vm --zone=us-central1-a --command="sudo systemctl status nginx"
```

To reload nginx after config changes:
```bash
gcloud compute ssh philosophy-bot-vm --zone=us-central1-a --command="sudo nginx -t && sudo systemctl reload nginx"
```

### Static File Hosting
The FastAPI backend serves static files for TikTok API access:
- **Images**: Mounted at `/static/images/` â†’ filesystem `generated_images/`
- **Slides**: Mounted at `/static/slides/` â†’ filesystem `generated_slideshows/`

Example URLs:
```
https://api.cofndrly.com/static/images/King_Solomon_scene_1_nano.png
https://api.cofndrly.com/static/slides/gpt15/Stoicism_slide_0.png
```

### Firewall Rules
Ports 80 and 443 are open for HTTP/HTTPS traffic:
```bash
gcloud compute firewall-rules list --filter="name~http"
```

### TikTok Integration

**âš ï¸ CRITICAL: DRAFTS ONLY via MEDIA_UPLOAD mode**
- All TikTok uploads go to DRAFTS (user's inbox), never direct publish
- User's TikTok account can be PUBLIC - we use `post_mode: "MEDIA_UPLOAD"` which works with public accounts
- NEVER use `post_mode: "DIRECT_POST"` - that requires private accounts in sandbox mode
- The `MEDIA_UPLOAD` mode sends content to user's TikTok inbox/drafts where they complete the post
- NEVER change code to post directly to TikTok feed

**API Modes (IMPORTANT):**
- `MEDIA_UPLOAD` = Sends to inbox/drafts âœ… (works with public accounts, user completes post in app)
- `DIRECT_POST` = Publishes directly âŒ (requires private account in sandbox - DO NOT USE)

**Image Format (CRITICAL):**
- TikTok photo API only accepts **JPEG (.jpg)** or **WebP** format
- PNG files will fail with `file_format_check_failed` error
- Always generate/convert images to JPEG before posting
- The `tiktok_poster.py` automatically converts paths to .jpg URLs

**Configuration:**
- **Redirect URI**: `https://api.cofndrly.com/api/tiktok/callback`
- **Domain Verification**: âœ… `api.cofndrly.com` is verified in TikTok Developer Portal
- **Scopes**: `user.info.basic`, `video.upload`, `video.publish`
- Tokens stored in `.tiktok_tokens.json` (gitignored)

TikTok CLI commands:
```bash
# Start OAuth flow
python tiktok_cli.py auth

# Exchange code for tokens
python tiktok_cli.py token --code "YOUR_CODE"

# Upload video to drafts
python tiktok_cli.py upload --video "path/to/video.mp4" --title "Caption"

# Upload photo slideshow (uses native TikTok slideshow)
python tiktok_cli.py slideshow --images "img1.png,img2.png" --title "Caption"

# Check upload status
python tiktok_cli.py status --publish-id "PUBLISH_ID"

# View config and token status
python tiktok_cli.py info
```

### Frontend Deployment (Vercel)
The React frontend is deployed on Vercel at `https://app.cofndrly.com`.

**Vercel Project**: `frontend` under `sharozs-projects-b7468887`
**Environment Variable**: `VITE_API_URL=https://api.cofndrly.com`

Deploy commands:
```bash
cd frontend
npx vercel --prod      # Deploy to production
npx vercel env ls      # List environment variables
npx vercel logs        # View deployment logs
```

**DNS Setup Required** (GoDaddy):
Add an A record: `app.cofndrly.com` â†’ `76.76.21.21` (Vercel's IP)

### Automation Scheduler
The backend includes APScheduler for running automations:

**How it works:**
1. Scheduler starts with the backend app
2. Loads all automations where `status="running"` and `is_active=True`
3. Creates cron jobs based on `schedule_times` and `schedule_days`
4. When triggered: generates slideshow â†’ optionally posts to TikTok
5. Tracks run history in `automation_runs` table

**Key files:**
- `backend/app/services/scheduler.py` - APScheduler service
- `backend/app/services/tiktok_poster.py` - TikTok posting service
- `backend/app/models/automation_run.py` - Run history model

**API Endpoints:**
```bash
# Start/stop automation
POST /api/automations/{id}/start
POST /api/automations/{id}/stop

# Trigger immediate run (for testing)
POST /api/automations/{id}/run-now

# View run history
GET /api/automations/{id}/runs

# Get scheduler status
GET /api/automations/scheduler/status

# Configure TikTok posting
PUT /api/automations/{id}/tiktok-settings
```

**Enable TikTok auto-posting:**
Set `post_to_tiktok: true` in automation settings to automatically post slideshows.

### GitHub Actions Deployment
The project uses GitHub Actions for automated deployment. See `.github/workflows/deploy.yml`.

## AI Agent & Gallery System

### Agent Page Architecture (`/frontend/src/pages/Agent.tsx`)
The AI Agent page is a **full-page chat interface** with integrated gallery:

**Layout:**
- Uses full viewport height (`height: calc(100vh - 64px)`)
- Header with logo, status badge, and Chat/Gallery tabs
- Chat area with messages, tool calls, and slide previews
- Input bar fixed at bottom of chat area (NOT page bottom)
- Negative margins to break out of Layout padding

**Key Features:**
- **Tabs**: Chat tab for conversation, Gallery tab for all assets
- **Streaming**: Uses SSE for real-time Claude responses
- **Tool Calls**: Displays active tools while streaming
- **Slide Previews**: Shows generated slides inline in chat
- **Auto-save**: Slides automatically save to gallery when generated

**State Management:**
```typescript
const [activeTab, setActiveTab] = useState<'chat' | 'gallery'>('chat');
const [galleryFilter, setGalleryFilter] = useState<'all' | 'slides' | 'scripts' | 'drafts'>('all');
const { items: galleryItems, stats, addSlide } = useGallery();
```

### Gallery System

**Database Model (`/backend/app/models/gallery_item.py`):**
```python
class GalleryItem(Base):
    __tablename__ = "gallery_items"
    
    id = Column(String(36), primary_key=True)
    item_type = Column(String(50))  # 'slide', 'script', 'prompt', 'image', 'project'
    project_id = Column(String(36), nullable=True)
    slide_id = Column(String(36), nullable=True)
    title = Column(String(255))
    image_url = Column(String(500))
    font = Column(String(50))
    theme = Column(String(50))
    content_style = Column(String(50))
    extra_data = Column(JSON)  # NOTE: 'metadata' is reserved by SQLAlchemy!
    status = Column(String(50))  # 'complete', 'draft', 'failed'
    session_id = Column(String(36))
```

**âš ï¸ IMPORTANT**: Never use `metadata` as a column name in SQLAlchemy models - it's reserved!

**API Endpoints (`/backend/app/routers/gallery.py`):**
```bash
GET  /api/gallery                    # List all items (supports filtering)
POST /api/gallery                    # Create item
GET  /api/gallery/{id}               # Get single item
PUT  /api/gallery/{id}               # Update item
DELETE /api/gallery/{id}             # Delete item
DELETE /api/gallery                  # Clear all
GET  /api/gallery/stats/summary      # Get statistics
```

**Frontend Context (`/frontend/src/context/GalleryContext.tsx`):**
```typescript
// Uses TanStack Query for API sync
const { items, stats, addSlide, removeItem, hasItem, clearGallery } = useGallery();

// addSlide converts SlidePreviewData to GalleryItem automatically
await addSlide(slidePreviewData);
```

**Gallery Tab Filters:**
- All: Shows everything
- Slides: Only `item_type === 'slide'`
- Scripts: `item_type === 'script'` or `'prompt'`
- Drafts: `status === 'draft'`

### Agent Streaming Protocol

The agent uses Server-Sent Events (SSE) with these event types:

```typescript
type AgentStreamEvent =
  | { type: 'session'; session_id: string }
  | { type: 'text'; text: string }
  | { type: 'thinking'; text: string }
  | { type: 'tool_start'; tool_name: string; tool_input: Record<string, unknown> }
  | { type: 'tool_result'; tool_name: string; result: Record<string, unknown>; success: boolean }
  | { type: 'slide_preview'; slide: SlidePreviewData }
  | { type: 'done'; iterations: number; tool_count: number }
  | { type: 'error'; message: string };
```

**Usage in frontend:**
```typescript
cleanupRef.current = streamAgentMessage(
  message,
  sessionId,
  handleStreamEvent,  // Processes each event
  onError,
  onComplete
);
```

### Adding New Gallery Item Types

1. Update `item_type` enum in model (already flexible - just use new string)
2. Add filter option in Agent.tsx `galleryFilter` type
3. Add filter button in Gallery tab
4. Update `filteredGalleryItems` logic to handle new type

### Key Files for Agent/Gallery
- `/frontend/src/pages/Agent.tsx` - Main agent page with tabs
- `/frontend/src/context/GalleryContext.tsx` - Gallery state with API sync
- `/frontend/src/api/client.ts` - Gallery API functions
- `/backend/app/models/gallery_item.py` - Database model
- `/backend/app/routers/gallery.py` - API endpoints
- `/backend/app/routers/agent.py` - Agent chat endpoints

## Code Style
- Python: Follow PEP 8, use type hints
- TypeScript: Strict mode, prefer interfaces over types
- React: Functional components with hooks only
- CSS: Inline styles with motion animations preferred
